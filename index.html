<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <canvas id="canvas" width="400px" height="400px">
    </canvas>
    <script>
        const canvas = document.getElementById("canvas");
        const shipImage = new Image();
        const bulletImage = new Image();
        const enemyImage = new Image();
        shipImage.src = "img/ship.png";
        bulletImage.src = "img/bullet.png";
        enemyImage.src = "img/enemy.png"
        context = canvas.getContext("2d")
        ship_speed = 5
        bullet_speed = 5
        enemy_speed = 5
        bullets = []
        enemies = []

        document.body.addEventListener("keydown", keydown)
        document.body.addEventListener("keyup", keyup)

        function keydown(e) {
            console.log(e.key)
            switch(event.key){
                case "ArrowLeft":
                    ship.vx -= ship_speed
                    break

                case "ArrowRight":
                    ship.vx += ship_speed
                    break

                case "ArrowUp":
                    ship.vy -= ship_speed
                    break

                case "ArrowDown":
                    ship.vy += ship_speed
                    break
                    
                case "f":
                    ship.shot()
                    break
            }
        }

        function keyup(e) {
            ship.vx = 0;
            ship.vy = 0;
        }

        const ship = {
            w: 40, h: 40,
            ctx: context,
            x:canvas.width/2, y: canvas.height-40, vx:0, vy: 0,
            draw: function(){
                this.ctx.drawImage(shipImage, this.x, this.y, this.w, this.h)
            },
            move: function(ctx){
                this.x+=this.vx
                this.y+=this.vy

                bullets.forEach(element => {
                    element.draw(ctx)
                    element.move()
                });
            },
            shot: function(){
                bullet = new Bullet(this.x, this.y, 0, -bullet_speed)
                bullets.push(bullet)
            }
        }

        class Entity {
            x;
            y;
            vx;
            vy;
            w;
            h;
            constructor (x, y, vx, vy){
                this.x=x; this.y=y;
                this.vx=vx; this.vy=vy;
                this.w = 50; this.h = 50;
            }
            draw(ctx) {}
            move() {
                this.x += this.vx
                this.y += this.vy
            }
        }

        class Bullet extends Entity { //si ho deciso di imparare le sottoclassi
            draw(ctx) {
                ctx.drawImage(bulletImage, this.x, this.y, this.w, this.h)
            }
        }

        class Enemy extends Entity{ //visto? utile no?????????
            move(canvas) {
                this.x += this.vx
                if (this.vx > 0 && this.x > canvas.width-this.w){
                    this.vx = -this.vx
                } else if (this.vx < 0 && this.x <= 0) {
                    this.vx = -this.vx
                }
            }
            draw(ctx) {
                ctx.drawImage(enemyImage, this.x, this.y, this.w, this.h)
            }
        }

        enemies.push(
            new Enemy(0, 0, enemy_speed, 0)
        )

        function draw(){
            context.clearRect(0,0,canvas.width, canvas.height)
            ship.draw(context)
            ship.move(context)
            enemies.forEach(element => {
                element.draw(context)
                element.move(canvas)
            });
            window.requestAnimationFrame(draw);
        }
        window.requestAnimationFrame(draw);
    </script>
</body>
</html>